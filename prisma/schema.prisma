generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}









enum Role {
  USER
  ADMIN
}

enum OrderStatus {
  PENDING
  PAID
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

model Category {
  id         Int      @id @default(autoincrement())
  name       String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  products Product[]
}

model Product {
  id          Int      @id @default(autoincrement())
  img         String
  name        String
  price       Int
  old_price   Int?
  category_id Int
  category    Category @relation(fields: [category_id], references: [id], onDelete: Cascade)
  sku         String   @default("TBD")
  stock       Int      @default(0)
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  is_available Boolean     @default(true)
  kits         Kits[]
  cart         Cart[]
  wishlist     Wishlist[]
  orderItems   OrderItem[]
}

model Kits {
  id         Int      @id @default(autoincrement())
  name       String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  products Product[]
}

model User {
  id         Int      @id @default(autoincrement())
  username   String?  @unique
  email      String   @unique
  password   String
  role       Role     @default(USER)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  profile  Profile?
  cart     Cart[]
  wishlist Wishlist[]
  orders   Order[]
}

model Profile {
  id         Int      @id @default(autoincrement())
  user_id    Int      @unique
  first_name String?
  img        String?
  last_name  String?
  phone      String?
  address    String?
  city       String?
  state      String?
  zip_code   String?
  country    String?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model Cart {
  id         Int      @id @default(autoincrement())
  user_id    Int
  product_id Int
  quantity   Int      @default(1)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user    User    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  product Product @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@unique([user_id, product_id])
}

model Wishlist {
  id         Int      @id @default(autoincrement())
  user_id    Int
  product_id Int
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user    User    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  product Product @relation(fields: [product_id], references: [id], onDelete: Cascade)
}

model Order {
  id               Int         @id @default(autoincrement())
  user_id          Int
  order_number     String      @unique @default(uuid())
  total_amount     Int
  tax_amount       Int         @default(0)
  discount         Int         @default(0)
  shipping_address String
  billing_address  String
  payment_method   String
  payment_status   String      @default("pending")
  status           OrderStatus @default(PENDING)
  notes            String?
  created_at       DateTime    @default(now())
  updated_at       DateTime    @updatedAt
  cancelled_at     DateTime?

  user       User        @relation(fields: [user_id], references: [id], onDelete: Cascade)
  orderItems OrderItem[]

  @@index([user_id])
  @@index([order_number])
  @@index([status])
  @@index([created_at])
}

model OrderItem {
  id         Int      @id @default(autoincrement())
  order_id   Int
  product_id Int
  quantity   Int
  unit_price Int
  subtotal   Int
  created_at DateTime @default(now())

  order   Order   @relation(fields: [order_id], references: [id], onDelete: Cascade)
  product Product @relation(fields: [product_id], references: [id])

  @@unique([order_id, product_id])
  @@index([order_id])
  @@index([product_id])
}